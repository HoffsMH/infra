#!/bin/bash

export B2_ACCOUNT_ID={{ lookup('env', 'B2_ACCOUNT_ID') }} 
export B2_ACCOUNT_KEY={{ lookup('env', 'B2_ACCOUNT_KEY') }} 
export RESTIC_REPOSITORY={{ lookup('env', 'RESTIC_REPOSITORY') }} 
export RESTIC_PASSWORD={{ lookup('env', 'RESTIC_PASSWORD') }} 

restic backup --verbose \
  -r {{ lookup('env', 'RESTIC_REPOSITORY') }} \
--exclude-file=/infra/assets/restic/restic/excludes \
/mnt/storage/data > /mnt/storage/infra/nas/restic/log
